<!DOCTYPE html><html lang="en"><head><title>07-event</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="07-event"><meta name="groc-project-path" content="jquery-1.6.2/07-event.js"><meta name="groc-github-url" content="https://github.com/nevir/jquery-annotated-source"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/nevir/jquery-annotated-source/blob/master/jquery-1.6.2/07-event.js">jquery-1.6.2/07-event.js</a></div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="chapter-7-events">Chapter 7: Events</h1></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><a href="/jquery-annotated-source/">Home</a> | <a href="06-attributes.html">Previous Chapter</a> | <a href="08-selector.html">Next Chapter</a></p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">rnamespaces</span> <span class="o">=</span> <span class="sr">/\.(.*)$/</span><span class="p">,</span>
  <span class="nx">rformElems</span> <span class="o">=</span> <span class="sr">/^(?:textarea|input|select)$/i</span><span class="p">,</span>
  <span class="nx">rperiod</span> <span class="o">=</span> <span class="sr">/\./g</span><span class="p">,</span>
  <span class="nx">rspaces</span> <span class="o">=</span> <span class="sr">/ /g</span><span class="p">,</span>
  <span class="nx">rescape</span> <span class="o">=</span> <span class="sr">/[^\w\s.|`]/g</span><span class="p">,</span>
  <span class="nx">fcleanup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">nm</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">nm</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rescape</span><span class="p">,</span> <span class="s2">&quot;\\$&amp;&quot;</span><span class="p">);</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>A number of helper functions used for managing events.
 Many of the ideas behind this code originated from
 Dean Edwards' addEvent library.</p></div></div><div class="code"><div class="wrapper"><span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Bind an event to an element
Original by Dean Edwards</p></div></div><div class="code"><div class="wrapper">  <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">8</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">returnFalse</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fixes bug #7229. Fix recommended by jdalton</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">handleObjIn</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handleObjIn</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">;</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">handleObjIn</span><span class="p">.</span><span class="nx">handler</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Make sure that the function being executed has a unique ID</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">guid</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Init the element's event structure</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">elemData</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If no elemData is found then we must be trying to bind to one of the
banned noData elements</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">elemData</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span>
      <span class="nx">eventHandle</span> <span class="o">=</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">events</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">elemData</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">eventHandle</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">elemData</span><span class="p">.</span><span class="nx">handle</span> <span class="o">=</span> <span class="nx">eventHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Discard the second event of a jQuery.event.trigger() and
when an event is called after a page has unloaded</p></div></div><div class="code"><div class="wrapper">        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">jQuery</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">e</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">triggered</span> <span class="o">!==</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="o">?</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="nx">eventHandle</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">)</span> <span class="o">:</span>
          <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add elem as a property of the handle function
This is to prevent a memory leak with non-native events in IE.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">eventHandle</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle multiple events separated by a space
jQuery(...).bind("mouseover mouseout", fn);</p></div></div><div class="code"><div class="wrapper">    <span class="nx">types</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span> <span class="nx">i</span><span class="o">++</span> <span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">handleObjIn</span> <span class="o">?</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">handleObjIn</span><span class="p">)</span> <span class="o">:</span>
        <span class="p">{</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span> <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Namespaced event handlers</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">namespaces</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">handleObj</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">guid</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handleObj</span><span class="p">.</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span><span class="p">;</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get the current list of functions bound to this event</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">handlers</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span> <span class="nx">type</span> <span class="p">],</span>
        <span class="nx">special</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">||</span> <span class="p">{};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Init the event handler queue</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handlers</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handlers</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check for a special event handler
Only use addEventListener/attachEvent if the special
events handler returns false</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">special</span><span class="p">.</span><span class="nx">setup</span> <span class="o">||</span> <span class="nx">special</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">eventHandle</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Bind the global event handler to the element</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">eventHandle</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>

          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">attachEvent</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">elem</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span> <span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">eventHandle</span> <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">special</span><span class="p">.</span><span class="nx">add</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">special</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">handleObj</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add the function to the element's handler list</p></div></div><div class="code"><div class="wrapper">      <span class="nx">handlers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">handleObj</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Keep track of which events have been used, for event optimization</p></div></div><div class="code"><div class="wrapper">      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">global</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Nullify elem to prevent memory leaks in IE</p></div></div><div class="code"><div class="wrapper">    <span class="nx">elem</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">global</span><span class="o">:</span> <span class="p">{},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Detach an event or set of events from an element</p></div></div><div class="code"><div class="wrapper">  <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">pos</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>don't do events on text and comment nodes</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">8</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">returnFalse</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">special</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">,</span> <span class="nx">origType</span><span class="p">,</span>
      <span class="nx">elemData</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">hasData</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">),</span>
      <span class="nx">events</span> <span class="o">=</span> <span class="nx">elemData</span> <span class="o">&amp;&amp;</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">elemData</span> <span class="o">||</span> <span class="o">!</span><span class="nx">events</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>types is actually an event object here</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">types</span> <span class="o">&amp;&amp;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">handler</span><span class="p">;</span>
      <span class="nx">types</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Unbind all events for the element</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">types</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">types</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">types</span> <span class="o">=</span> <span class="nx">types</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">events</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">types</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle multiple events separated by a space
jQuery(...).unbind("mouseover mouseout", fn);</p></div></div><div class="code"><div class="wrapper">    <span class="nx">types</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span> <span class="nx">i</span><span class="o">++</span> <span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">origType</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
      <span class="nx">handleObj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">all</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">namespaces</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">all</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Namespaced event handlers</p></div></div><div class="code"><div class="wrapper">        <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

        <span class="nx">namespace</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\.)&quot;</span> <span class="o">+</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">sort</span><span class="p">(),</span> <span class="nx">fcleanup</span> <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\.(?:.*\\.)?&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;(\\.|$)&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">eventType</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span> <span class="nx">type</span> <span class="p">];</span>

      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">eventType</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">eventType</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">eventType</span><span class="p">[</span> <span class="nx">j</span> <span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span> <span class="nx">all</span> <span class="o">||</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">origType</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">j</span> <span class="p">);</span>
            <span class="nx">eventType</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span> <span class="nx">j</span><span class="o">--</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">special</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>

      <span class="k">for</span> <span class="p">(</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">pos</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">eventType</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">eventType</span><span class="p">[</span> <span class="nx">j</span> <span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="o">===</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">guid</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>remove the given handler for the given type</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="nx">all</span> <span class="o">||</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">pos</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">eventType</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span> <span class="nx">j</span><span class="o">--</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nx">special</span><span class="p">.</span><span class="nx">remove</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">special</span><span class="p">.</span><span class="nx">remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">handleObj</span> <span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span> <span class="nx">pos</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>remove generic event handler if no more handlers exist</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="nx">eventType</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">pos</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">eventType</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">special</span><span class="p">.</span><span class="nx">teardown</span> <span class="o">||</span> <span class="nx">special</span><span class="p">.</span><span class="nx">teardown</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">namespaces</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">handle</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">events</span><span class="p">[</span> <span class="nx">type</span> <span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Remove the expando if it's no longer used</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span> <span class="nx">events</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">handle</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handle</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">delete</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>
      <span class="k">delete</span> <span class="nx">elemData</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span> <span class="nx">elemData</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Events that are safe to short-circuit if no handlers are attached.
Native DOM events should not be added, they may have inline handlers.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">customEvent</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;getData&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;setData&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;changeData&quot;</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>

  <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">onlyHandlers</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Event object or event type</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="nx">event</span><span class="p">,</span>
      <span class="nx">namespaces</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">exclusive</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Exclusive events trigger only for the exact event (no namespaces)</p></div></div><div class="code"><div class="wrapper">      <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="nx">exclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Namespaced trigger; create a regexp to match event type in handle()</p></div></div><div class="code"><div class="wrapper">      <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="nx">namespaces</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="nx">elem</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">customEvent</span><span class="p">[</span> <span class="nx">type</span> <span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">global</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>No jQuery handlers for this event type, and it can't have inline handlers</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Caller can pass in an Event, Object, or just an event type string</p></div></div><div class="code"><div class="wrapper">    <span class="nx">event</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">event</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>jQuery.Event object</p></div></div><div class="code"><div class="wrapper">      <span class="nx">event</span><span class="p">[</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">expando</span> <span class="p">]</span> <span class="o">?</span> <span class="nx">event</span> <span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Object literal</p></div></div><div class="code"><div class="wrapper">      <span class="k">new</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">event</span> <span class="p">)</span> <span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Just the event type (string)</p></div></div><div class="code"><div class="wrapper">      <span class="k">new</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span> <span class="nx">type</span> <span class="p">);</span>

    <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">exclusive</span> <span class="o">=</span> <span class="nx">exclusive</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">namespace_re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\.)&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\.(?:.*\\.)?&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;(\\.|$)&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>triggerHandler() and global events don't bubble or run the default action</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">onlyHandlers</span> <span class="o">||</span> <span class="o">!</span><span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle a global trigger</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: Stop taunting the data cache; remove global events and always attach to document</p></div></div><div class="code"><div class="wrapper">      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">cache</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>internalKey variable is just used to make it easier to find
and potentially change this stuff later; currently it just
points to jQuery.expando</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">internalKey</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">expando</span><span class="p">,</span>
          <span class="nx">internalCache</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span> <span class="nx">internalKey</span> <span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">internalCache</span> <span class="o">&amp;&amp;</span> <span class="nx">internalCache</span><span class="p">.</span><span class="nx">events</span> <span class="o">&amp;&amp;</span> <span class="nx">internalCache</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">internalCache</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">elem</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Don't do events on text and comment nodes</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">8</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Clean up the event in case it is being reused</p></div></div><div class="code"><div class="wrapper">    <span class="nx">event</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Clone any incoming data and prepend the event, creating the handler arg list</p></div></div><div class="code"><div class="wrapper">    <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span> <span class="nx">event</span> <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">cur</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>IE doesn't like method names with a colon (#3533, #8272)</p></div></div><div class="code"><div class="wrapper">      <span class="nx">ontype</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fire event on the current element, then bubble up the DOM tree</p></div></div><div class="code"><div class="wrapper">    <span class="k">do</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">cur</span><span class="p">,</span> <span class="s2">&quot;handle&quot;</span> <span class="p">);</span>

      <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">cur</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">handle</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handle</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="nx">cur</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Trigger an inline bound script</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="nx">ontype</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">acceptData</span><span class="p">(</span> <span class="nx">cur</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">cur</span><span class="p">[</span> <span class="nx">ontype</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">cur</span><span class="p">[</span> <span class="nx">ontype</span> <span class="p">].</span><span class="nx">apply</span><span class="p">(</span> <span class="nx">cur</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Bubble up to document, then to window</p></div></div><div class="code"><div class="wrapper">      <span class="nx">cur</span> <span class="o">=</span> <span class="nx">cur</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">||</span> <span class="nx">cur</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span> <span class="nx">cur</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span> <span class="nx">cur</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">()</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If nobody prevented the default action, do it now</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">old</span><span class="p">,</span>
        <span class="nx">special</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>

      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="nx">special</span><span class="p">.</span><span class="nx">_default</span> <span class="o">||</span> <span class="nx">special</span><span class="p">.</span><span class="nx">_default</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">,</span> <span class="nx">event</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;click&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span> <span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">acceptData</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call a native DOM method on the target with the same name name as the event.
Can't use an .isFunction)() check here because IE6/7 fails that test.
IE&lt;9 dies on focus to hidden element (#1486), may want to revisit a try/catch.</p></div></div><div class="code"><div class="wrapper">        <span class="k">try</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">ontype</span> <span class="o">&amp;&amp;</span> <span class="nx">elem</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Don't re-trigger an onFOO event when we call its FOO() method</p></div></div><div class="code"><div class="wrapper">            <span class="nx">old</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">[</span> <span class="nx">ontype</span> <span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nx">old</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">elem</span><span class="p">[</span> <span class="nx">ontype</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">triggered</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
            <span class="nx">elem</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]();</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">ieError</span> <span class="p">)</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">old</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">elem</span><span class="p">[</span> <span class="nx">ontype</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">old</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">triggered</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">handle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">fix</span><span class="p">(</span> <span class="nx">event</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Snapshot the handlers list since a called handler may add/remove events.</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">handlers</span> <span class="o">=</span> <span class="p">((</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;events&quot;</span> <span class="p">)</span> <span class="o">||</span> <span class="p">{})[</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="p">]</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
      <span class="nx">run_all</span> <span class="o">=</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">exclusive</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">namespace</span><span class="p">,</span>
      <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Use the fix-ed Event rather than the (read-only) native event</p></div></div><div class="code"><div class="wrapper">    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span> <span class="nx">j</span> <span class="p">];</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Triggered event must 1) be non-exclusive and have no namespace, or
2) have namespace(s) a subset or equal to those in the bound event.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="nx">run_all</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">namespace_re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Pass in a reference to the handler function itself
So that we can later remove it</p></div></div><div class="code"><div class="wrapper">        <span class="nx">event</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">ret</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isImmediatePropagationStopped</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">props</span><span class="o">:</span> <span class="s2">&quot;altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which&quot;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>

  <span class="nx">fix</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">[</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">expando</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>store a copy of the original event object
and "clone" to set read-only properties</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">originalEvent</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
    <span class="nx">event</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span> <span class="nx">originalEvent</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">prop</span><span class="p">;</span> <span class="nx">i</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">prop</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">[</span> <span class="o">--</span><span class="nx">i</span> <span class="p">];</span>
      <span class="nx">event</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">originalEvent</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">];</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fix target property, if necessary</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fixes #1925 where srcElement might not be defined either</p></div></div><div class="code"><div class="wrapper">      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>check if target is a textnode (safari)</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add relatedTarget, if necessary</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">fromElement</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">fromElement</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">?</span> <span class="nx">event</span><span class="p">.</span><span class="nx">toElement</span> <span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">fromElement</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Calculate pageX/Y if missing and clientX/Y available</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">eventDocument</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span> <span class="nb">document</span><span class="p">,</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">eventDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nx">eventDocument</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

      <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientTop</span>  <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">clientTop</span>  <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add which for key events</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add metaKey to non-Mac browsers (use ctrl for PC's and Meta for Macs)</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add which for click: 1 === left; 2 === middle; 3 === right
Note: button is not normalized, so don't use it</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Deprecated, use jQuery.guid instead</p></div></div><div class="code"><div class="wrapper">  <span class="nx">guid</span><span class="o">:</span> <span class="mi">1</span><span class="nx">E8</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Deprecated, use jQuery.proxy instead</p></div></div><div class="code"><div class="wrapper">  <span class="nx">proxy</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">,</span>

  <span class="nx">special</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">ready</span><span class="o">:</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Make sure the ready event is setup</p></div></div><div class="code"><div class="wrapper">      <span class="nx">setup</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">bindReady</span><span class="p">,</span>
      <span class="nx">teardown</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">noop</span>
    <span class="p">},</span>

    <span class="nx">live</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">handleObj</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span>
          <span class="nx">liveConvert</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="p">),</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">handleObj</span><span class="p">,</span> <span class="p">{</span><span class="nx">handler</span><span class="o">:</span> <span class="nx">liveHandler</span><span class="p">,</span> <span class="nx">guid</span><span class="o">:</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span><span class="p">})</span> <span class="p">);</span>
      <span class="p">},</span>

      <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">handleObj</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">liveConvert</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="p">),</span> <span class="nx">handleObj</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">beforeunload</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">eventHandle</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>We only want to do this special case on windows</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">(</span> <span class="k">this</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">=</span> <span class="nx">eventHandle</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">eventHandle</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">===</span> <span class="nx">eventHandle</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">removeEvent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span> <span class="o">?</span>
  <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">removeEventListener</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="o">:</span>
  <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">detachEvent</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span> <span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Allow instantiation without the 'new' keyword</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">props</span> <span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Event object</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span> <span class="nx">src</span> <span class="o">&amp;&amp;</span> <span class="nx">src</span><span class="p">.</span><span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Events bubbling up the document may have been marked as prevented
by a handler lower down the tree; reflect the correct value.</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">isDefaultPrevented</span> <span class="o">=</span> <span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">defaultPrevented</span> <span class="o">||</span> <span class="nx">src</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span>
      <span class="nx">src</span><span class="p">.</span><span class="nx">getPreventDefault</span> <span class="o">&amp;&amp;</span> <span class="nx">src</span><span class="p">.</span><span class="nx">getPreventDefault</span><span class="p">())</span> <span class="o">?</span> <span class="nx">returnTrue</span> <span class="o">:</span> <span class="nx">returnFalse</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Event type</p></div></div><div class="code"><div class="wrapper">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Put explicitly provided properties onto the event object</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">props</span> <span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>timeStamp is buggy for some events on Firefox(#3843)
So we won't rely on the native value</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">timeStamp</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Mark it as fixed</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">[</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">expando</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">returnFalse</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">returnTrue</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html</p></div></div><div class="code"><div class="wrapper"><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">preventDefault</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isDefaultPrevented</span> <span class="o">=</span> <span class="nx">returnTrue</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>if preventDefault exists run it on the original event</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>otherwise set the returnValue property of the original event to false (IE)</p></div></div><div class="code"><div class="wrapper">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">stopPropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isPropagationStopped</span> <span class="o">=</span> <span class="nx">returnTrue</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>if stopPropagation exists run it on the original event</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>otherwise set the cancelBubble property of the original event to true (IE)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">cancelBubble</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">stopImmediatePropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isImmediatePropagationStopped</span> <span class="o">=</span> <span class="nx">returnTrue</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">isDefaultPrevented</span><span class="o">:</span> <span class="nx">returnFalse</span><span class="p">,</span>
  <span class="nx">isPropagationStopped</span><span class="o">:</span> <span class="nx">returnFalse</span><span class="p">,</span>
  <span class="nx">isImmediatePropagationStopped</span><span class="o">:</span> <span class="nx">returnFalse</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Checks if an event happened on an element within another element
Used in jQuery.event.special.mouseenter and mouseleave handlers</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">withinElement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check if mouse(over|out) are still within the same parent element</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">related</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">,</span>
    <span class="nx">inside</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">eventType</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>

  <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">related</span> <span class="o">!==</span> <span class="k">this</span> <span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">related</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">inside</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">related</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">inside</span> <span class="p">)</span> <span class="p">{</span>

      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>

      <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">eventType</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>In case of event delegation, we only need to rename the event.type,
liveHandler will take care of the rest.</p></div></div><div class="code"><div class="wrapper"><span class="nx">delegate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create mouseenter and mouseleave events</p></div></div><div class="code"><div class="wrapper"><span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span>
  <span class="nx">mouseenter</span><span class="o">:</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">,</span>
  <span class="nx">mouseleave</span><span class="o">:</span> <span class="s2">&quot;mouseout&quot;</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">orig</span><span class="p">,</span> <span class="nx">fix</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">orig</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">fix</span><span class="p">,</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">selector</span> <span class="o">?</span> <span class="nx">delegate</span> <span class="o">:</span> <span class="nx">withinElement</span><span class="p">,</span> <span class="nx">orig</span> <span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">fix</span><span class="p">,</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">selector</span> <span class="o">?</span> <span class="nx">delegate</span> <span class="o">:</span> <span class="nx">withinElement</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>submit delegation</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">submitBubbles</span> <span class="p">)</span> <span class="p">{</span>

  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">.</span><span class="nx">submit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespaces</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;click.specialSubmit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;submit&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">trigger</span><span class="p">(</span> <span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>

        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;keypress.specialSubmit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;text&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">13</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">trigger</span><span class="p">(</span> <span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">namespaces</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;.specialSubmit&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>change delegation, happens here so we have bind.</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">changeBubbles</span> <span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">changeFilters</span><span class="p">,</span>

  <span class="nx">getVal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;radio&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;checkbox&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">val</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;select-multiple&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">val</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">selectedIndex</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">?</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">selected</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">:</span>
        <span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">val</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">testChange</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">testChange</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">val</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">rformElems</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeName</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">readOnly</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">data</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;_change_data&quot;</span> <span class="p">);</span>
    <span class="nx">val</span> <span class="o">=</span> <span class="nx">getVal</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>the current data will be also retrieved by beforeactivate</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;focusout&quot;</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;radio&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;_change_data&quot;</span><span class="p">,</span> <span class="nx">val</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span><span class="p">;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">liveFired</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">elem</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">.</span><span class="nx">change</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">filters</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">focusout</span><span class="o">:</span> <span class="nx">testChange</span><span class="p">,</span>

      <span class="nx">beforedeactivate</span><span class="o">:</span> <span class="nx">testChange</span><span class="p">,</span>

      <span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;radio&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;checkbox&quot;</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">testChange</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">e</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Change has to be called before submit
Keydown will be called before keypress, which is used in submit-event delegation</p></div></div><div class="code"><div class="wrapper">      <span class="nx">keydown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;textarea&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="o">||</span>
          <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">32</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;checkbox&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;radio&quot;</span><span class="p">))</span> <span class="o">||</span>
          <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;select-multiple&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">testChange</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">e</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Beforeactivate happens also before the previous element is blurred
with this event you can't trigger a change event, but you can store
information</p></div></div><div class="code"><div class="wrapper">      <span class="nx">beforeactivate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;_change_data&quot;</span><span class="p">,</span> <span class="nx">getVal</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespaces</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;file&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">changeFilters</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;.specialChange&quot;</span><span class="p">,</span> <span class="nx">changeFilters</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">rformElems</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeName</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">namespaces</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;.specialChange&quot;</span> <span class="p">);</span>

      <span class="k">return</span> <span class="nx">rformElems</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeName</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">changeFilters</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">.</span><span class="nx">change</span><span class="p">.</span><span class="nx">filters</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle when the input is .focus()'d</p></div></div><div class="code"><div class="wrapper">  <span class="nx">changeFilters</span><span class="p">.</span><span class="nx">focus</span> <span class="o">=</span> <span class="nx">changeFilters</span><span class="p">.</span><span class="nx">beforeactivate</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">trigger</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">args</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Piggyback on a donor event to simulate a different one.
Fake originalEvent to avoid donor's stopPropagation, but if the
simulated event prevents default then we do the same on the donor.
Don't pass args or remember liveFired; they apply to the donor event.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="p">{},</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">liveFired</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">event</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">].</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create "bubbling" focus and blur events</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">focusinBubbles</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span> <span class="nx">focus</span><span class="o">:</span> <span class="s2">&quot;focusin&quot;</span><span class="p">,</span> <span class="nx">blur</span><span class="o">:</span> <span class="s2">&quot;focusout&quot;</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">orig</span><span class="p">,</span> <span class="nx">fix</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Attach a single capturing handler while someone wants focusin/focusout</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">attaches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">fix</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">attaches</span><span class="o">++</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="nx">orig</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">--</span><span class="nx">attaches</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span> <span class="nx">orig</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">handler</span><span class="p">(</span> <span class="nx">donor</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Donor event is always a native one; fix it and switch its type.
Let focusin/out handler cancel the donor focus/blur event.</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">fix</span><span class="p">(</span> <span class="nx">donor</span> <span class="p">);</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">fix</span><span class="p">;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">e</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">donor</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;bind&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">handler</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle object literals</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span> <span class="nx">name</span> <span class="p">](</span><span class="nx">key</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">type</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">fn</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">data</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;one&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">unbind</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span> <span class="p">);</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">handler</span><span class="p">.</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">guid</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">guid</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;unload&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="o">!==</span> <span class="s2">&quot;one&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">unbind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle object literals</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">type</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">type</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
      <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">delegate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">live</span><span class="p">(</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">undelegate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span> <span class="s2">&quot;live&quot;</span> <span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">die</span><span class="p">(</span> <span class="nx">types</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="nx">triggerHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">true</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">toggle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save reference to arguments for access in closure</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
      <span class="nx">guid</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">guid</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">guid</span><span class="o">++</span><span class="p">,</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">toggler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Figure out which function to execute</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">lastToggle</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;lastToggle&quot;</span> <span class="o">+</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">guid</span> <span class="p">)</span> <span class="o">||</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">%</span> <span class="nx">i</span><span class="p">;</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;lastToggle&quot;</span> <span class="o">+</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">guid</span><span class="p">,</span> <span class="nx">lastToggle</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Make sure that clicks stop</p></div></div><div class="code"><div class="wrapper">        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>and execute the function</p></div></div><div class="code"><div class="wrapper">        <span class="k">return</span> <span class="nx">args</span><span class="p">[</span> <span class="nx">lastToggle</span> <span class="p">].</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">)</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>link all the functions, so any of them can unbind this click handler</p></div></div><div class="code"><div class="wrapper">    <span class="nx">toggler</span><span class="p">.</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">guid</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">args</span><span class="p">[</span> <span class="nx">i</span><span class="o">++</span> <span class="p">].</span><span class="nx">guid</span> <span class="o">=</span> <span class="nx">guid</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span> <span class="nx">toggler</span> <span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">hover</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">fnOver</span><span class="p">,</span> <span class="nx">fnOut</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mouseenter</span><span class="p">(</span> <span class="nx">fnOver</span> <span class="p">).</span><span class="nx">mouseleave</span><span class="p">(</span> <span class="nx">fnOut</span> <span class="o">||</span> <span class="nx">fnOver</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">liveMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">focus</span><span class="o">:</span> <span class="s2">&quot;focusin&quot;</span><span class="p">,</span>
  <span class="nx">blur</span><span class="o">:</span> <span class="s2">&quot;focusout&quot;</span><span class="p">,</span>
  <span class="nx">mouseenter</span><span class="o">:</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">,</span>
  <span class="nx">mouseleave</span><span class="o">:</span> <span class="s2">&quot;mouseout&quot;</span>
<span class="p">};</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;live&quot;</span><span class="p">,</span> <span class="s2">&quot;die&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">origSelector</span> <span class="cm">/* Internal Use Only */</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">preType</span><span class="p">,</span>
      <span class="nx">selector</span> <span class="o">=</span> <span class="nx">origSelector</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">,</span>
      <span class="nx">context</span> <span class="o">=</span> <span class="nx">origSelector</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">types</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">types</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">types</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">context</span><span class="p">[</span> <span class="nx">name</span> <span class="p">](</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">types</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">selector</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;die&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">types</span> <span class="o">&amp;&amp;</span>
          <span class="nx">origSelector</span> <span class="o">&amp;&amp;</span> <span class="nx">origSelector</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span> <span class="p">{</span>

      <span class="nx">context</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span> <span class="nx">origSelector</span> <span class="p">);</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">||</span> <span class="nx">returnFalse</span><span class="p">;</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">types</span> <span class="o">=</span> <span class="p">(</span><span class="nx">types</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span> <span class="nx">i</span><span class="o">++</span> <span class="p">])</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="nx">rnamespaces</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span> <span class="nx">type</span> <span class="p">);</span>
      <span class="nx">namespaces</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">match</span> <span class="p">)</span>  <span class="p">{</span>
        <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="nx">rnamespaces</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;hover&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="s2">&quot;mouseenter&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="s2">&quot;mouseleave&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span> <span class="p">);</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">preType</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">liveMap</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">liveMap</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">+</span> <span class="nx">namespaces</span> <span class="p">);</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">;</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">liveMap</span><span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">||</span> <span class="nx">type</span><span class="p">)</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;live&quot;</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind live handler</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">context</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="s2">&quot;live.&quot;</span> <span class="o">+</span> <span class="nx">liveConvert</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">),</span>
            <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">selector</span><span class="o">:</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">origType</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">origHandler</span><span class="o">:</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">preType</span><span class="o">:</span> <span class="nx">preType</span> <span class="p">}</span> <span class="p">);</span>
        <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>unbind live handler</p></div></div><div class="code"><div class="wrapper">        <span class="nx">context</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span> <span class="s2">&quot;live.&quot;</span> <span class="o">+</span> <span class="nx">liveConvert</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">),</span> <span class="nx">fn</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">liveHandler</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">stop</span><span class="p">,</span> <span class="nx">maxLevel</span><span class="p">,</span> <span class="nx">related</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">handleObj</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">close</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span>
    <span class="nx">elems</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">selectors</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">events</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;events&quot;</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Make sure we avoid non-left-click bubbling in Firefox (#3861) and disabled elements in IE (#6911)</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">liveFired</span> <span class="o">===</span> <span class="k">this</span> <span class="o">||</span> <span class="o">!</span><span class="nx">events</span> <span class="o">||</span> <span class="o">!</span><span class="nx">events</span><span class="p">.</span><span class="nx">live</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;click&quot;</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">namespace</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">namespace</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\.)&quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">namespace</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\.(?:.*\\.)?&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;(\\.|$)&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">event</span><span class="p">.</span><span class="nx">liveFired</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">live</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">live</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">live</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">live</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="nx">rnamespaces</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">selectors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">live</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span> <span class="nx">j</span><span class="o">--</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">match</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="p">).</span><span class="nx">closest</span><span class="p">(</span> <span class="nx">selectors</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">close</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">live</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">live</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">close</span><span class="p">.</span><span class="nx">selector</span> <span class="o">===</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">namespace</span> <span class="o">||</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">close</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">disabled</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">elem</span> <span class="o">=</span> <span class="nx">close</span><span class="p">.</span><span class="nx">elem</span><span class="p">;</span>
        <span class="nx">related</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Those two events require additional checking</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">preType</span> <span class="o">===</span> <span class="s2">&quot;mouseenter&quot;</span> <span class="o">||</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">preType</span> <span class="o">===</span> <span class="s2">&quot;mouseleave&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">preType</span><span class="p">;</span>
          <span class="nx">related</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span> <span class="p">).</span><span class="nx">closest</span><span class="p">(</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="p">)[</span><span class="mi">0</span><span class="p">];</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Make sure not to accidentally match a child element with the same selector</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="nx">related</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">related</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">related</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">related</span> <span class="o">||</span> <span class="nx">related</span> <span class="o">!==</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">elems</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">elem</span><span class="o">:</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">handleObj</span><span class="o">:</span> <span class="nx">handleObj</span><span class="p">,</span> <span class="nx">level</span><span class="o">:</span> <span class="nx">close</span><span class="p">.</span><span class="nx">level</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">maxLevel</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">maxLevel</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">elem</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">handleObj</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">;</span>

    <span class="nx">ret</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origHandler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="nx">match</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">maxLevel</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">level</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">stop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isImmediatePropagationStopped</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">stop</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">liveConvert</span><span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;*&quot;</span> <span class="o">?</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rperiod</span><span class="p">,</span> <span class="s2">&quot;`&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rspaces</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="p">(</span><span class="s2">&quot;blur focus focusin focusout load resize scroll unload click dblclick &quot;</span> <span class="o">+</span>
  <span class="s2">&quot;mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave &quot;</span> <span class="o">+</span>
  <span class="s2">&quot;change select submit keydown keypress keyup error&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle event binding</p></div></div><div class="code"><div class="wrapper">  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">fn</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">name</span> <span class="p">);</span>
  <span class="p">};</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">attrFn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">attrFn</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>